<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>iris.gui.pyqtgraph.multiprocess.remoteproxy &#8212; iris  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for iris.gui.pyqtgraph.multiprocess.remoteproxy</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">__builtin__</span> <span class="k">as</span> <span class="nn">builtins</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">builtins</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># color printing for debugging</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="k">import</span> <span class="n">cprint</span>

<div class="viewcode-block" id="ClosedError"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.ClosedError">[docs]</a><span class="k">class</span> <span class="nc">ClosedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when an event handler receives a request to close the connection</span>
<span class="sd">    or discovers that the connection has been closed.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="NoResultError"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.NoResultError">[docs]</a><span class="k">class</span> <span class="nc">NoResultError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when a request for the return value of a remote call fails</span>
<span class="sd">    because the call has not yet returned.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

    
<div class="viewcode-block" id="RemoteEventHandler"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler">[docs]</a><span class="k">class</span> <span class="nc">RemoteEventHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class handles communication between two processes. One instance is present on </span>
<span class="sd">    each process and listens for communication from the other process. This enables</span>
<span class="sd">    (amongst other things) ObjectProxy instances to look up their attributes and call </span>
<span class="sd">    their methods.</span>
<span class="sd">    </span>
<span class="sd">    This class is responsible for carrying out actions on behalf of the remote process.</span>
<span class="sd">    Each instance holds one end of a Connection which allows python</span>
<span class="sd">    objects to be passed between processes.</span>
<span class="sd">    </span>
<span class="sd">    For the most common operations, see _import(), close(), and transfer()</span>
<span class="sd">    </span>
<span class="sd">    To handle and respond to incoming requests, RemoteEventHandler requires that its</span>
<span class="sd">    processRequests method is called repeatedly (this is usually handled by the Process</span>
<span class="sd">    classes defined in multiprocess.processes).</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handlers</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">## maps {process ID : handler}. This allows unpickler to determine which process</span>
                    <span class="c1">## an object proxy belongs to</span>
                         
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">## reqId: (status, result); cache of request results received from the remote process</span>
                          <span class="c1">## status is either &#39;result&#39; or &#39;error&#39;</span>
                          <span class="c1">##   if &#39;error&#39;, then result will be (exception, formatted exceprion)</span>
                          <span class="c1">##   where exception may be None if it could not be passed through the Connection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
                          
        <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">## maps {weakref(proxy): proxyId}; used to inform the remote process when a proxy has been deleted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        
        <span class="c1">## attributes that affect the behavior of the proxy. </span>
        <span class="c1">## See ObjectProxy._setProxyOptions for description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;callSync&#39;</span><span class="p">:</span> <span class="s1">&#39;sync&#39;</span><span class="p">,</span>      <span class="c1">## &#39;sync&#39;, &#39;async&#39;, &#39;off&#39;</span>
            <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>           <span class="c1">## float</span>
            <span class="s1">&#39;returnType&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>    <span class="c1">## &#39;proxy&#39;, &#39;value&#39;, &#39;auto&#39;</span>
            <span class="s1">&#39;autoProxy&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>      <span class="c1">## bool</span>
            <span class="s1">&#39;deferGetattr&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>   <span class="c1">## True, False</span>
            <span class="s1">&#39;noProxyTypes&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">LocalObjectProxy</span><span class="p">,</span> <span class="n">ObjectProxy</span> <span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="s1">&#39;noProxyTypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unicode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="s1">&#39;noProxyTypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">optsLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nextRequestId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exited</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Mutexes to help prevent issues when multiple threads access the same RemoteEventHandler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        
        <span class="n">RemoteEventHandler</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1">## register this handler as the one communicating with pid</span>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RemoteEventHandler.getHandler"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.getHandler">[docs]</a>    <span class="k">def</span> <span class="nf">getHandler</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span>
            <span class="k">raise</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.debugMsg"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.debugMsg">[docs]</a>    <span class="k">def</span> <span class="nf">debugMsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">cprint</span><span class="o">.</span><span class="n">cout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">] </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">%</span><span class="n">args</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> </div>
    
<div class="viewcode-block" id="RemoteEventHandler.getProxyOption"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.getProxyOption">[docs]</a>    <span class="k">def</span> <span class="nf">getProxyOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">optsLock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="RemoteEventHandler.setProxyOptions"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.setProxyOptions">[docs]</a>    <span class="k">def</span> <span class="nf">setProxyOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default behavior options for object proxies.</span>
<span class="sd">        See ObjectProxy._setProxyOptions for more info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">optsLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.processRequests"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.processRequests">[docs]</a>    <span class="k">def</span> <span class="nf">processRequests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process all pending requests from the pipe, return</span>
<span class="sd">        after no more events are immediately available. (non-blocking)</span>
<span class="sd">        Returns the number of events processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">processLock</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exited</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  processRequests: exited already; raise ClosedError.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
            
            <span class="n">numProcessed</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">poll</span><span class="p">():</span>
                <span class="c1">#try:</span>
                    <span class="c1">#poll = self.conn.poll()</span>
                    <span class="c1">#if not poll:</span>
                        <span class="c1">#break</span>
                <span class="c1">#except IOError:  # this can happen if the remote process dies.</span>
                                <span class="c1">## might it also happen in other circumstances?</span>
                    <span class="c1">#raise ClosedError()</span>
                        
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">handleRequest</span><span class="p">()</span>
                    <span class="n">numProcessed</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="n">ClosedError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;processRequests: got ClosedError from handleRequest; setting exited=True.&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exited</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">raise</span>
                <span class="c1">#except IOError as err:  ## let handleRequest take care of this.</span>
                    <span class="c1">#self.debugMsg(&#39;  got IOError from handleRequest; try again.&#39;)</span>
                    <span class="c1">#if err.errno == 4:  ## interrupted system call; try again</span>
                        <span class="c1">#continue</span>
                    <span class="c1">#else:</span>
                        <span class="c1">#raise</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error in process </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
                    
            <span class="k">if</span> <span class="n">numProcessed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;processRequests: finished </span><span class="si">%d</span><span class="s1"> requests&#39;</span><span class="p">,</span> <span class="n">numProcessed</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numProcessed</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.handleRequest"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.handleRequest">[docs]</a>    <span class="k">def</span> <span class="nf">handleRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle a single request from the remote process. </span>
<span class="sd">        Blocks until a request is available.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1">## args, kwds are double-pickled to ensure this recv() call never fails                </span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">nByteMsgs</span><span class="p">,</span> <span class="n">optStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> 
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  handleRequest: got EOFError from recv; raise ClosedError.&#39;</span><span class="p">)</span>
                <span class="c1">## remote process has shut down; end event loop</span>
                <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1">## interrupted system call; try again</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  handleRequest: got IOError 4 from recv; try again.&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  handleRequest: got IOError </span><span class="si">%d</span><span class="s1"> from recv (</span><span class="si">%s</span><span class="s1">); raise ClosedError.&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;  handleRequest: received </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">reqId</span><span class="p">)</span>
            
        <span class="c1">## read byte messages following the main request</span>
        <span class="n">byteData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nByteMsgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: reading </span><span class="si">%d</span><span class="s2"> byte messages&quot;</span><span class="p">,</span> <span class="n">nByteMsgs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nByteMsgs</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">byteData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">recv_bytes</span><span class="p">())</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: got EOF while reading byte messages; raise ClosedError.&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: got IOError 4 while reading byte messages; try again.&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: got IOError while reading byte messages; raise ClosedError.&quot;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
            
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;result&#39;</span> <span class="ow">or</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                <span class="n">resultId</span> <span class="o">=</span> <span class="n">reqId</span>
                <span class="n">reqId</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">## prevents attempt to return information from this request</span>
                              <span class="c1">## (this is already a return from a previous request)</span>
            
            <span class="n">opts</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">optStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: id=</span><span class="si">%s</span><span class="s2"> opts=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="c1">#print os.getpid(), &quot;received request:&quot;, cmd, reqId, opts</span>
            <span class="n">returnType</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;returnType&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultLock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">resultId</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultLock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">resultId</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;exception&#39;</span><span class="p">],</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;excString&#39;</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;getObjAttr&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">],</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;callObj&#39;</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">]</span>
                <span class="n">fnargs</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
                <span class="n">fnkwds</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;kwds&#39;</span><span class="p">]</span>
                
                <span class="c1">## If arrays were sent as byte messages, they must be re-inserted into the </span>
                <span class="c1">## arguments</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteData</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fnargs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;__byte_message__&#39;</span><span class="p">:</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">fnargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">byteData</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">arg</span> <span class="ow">in</span> <span class="n">fnkwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;__byte_message__&#39;</span><span class="p">:</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">fnkwds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">byteData</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnkwds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1">## need to do this because some functions do not allow keyword arguments.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="p">(</span><span class="o">*</span><span class="n">fnargs</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to call object </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnargs</span><span class="p">),</span> <span class="n">fnargs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                        <span class="k">raise</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="p">(</span><span class="o">*</span><span class="n">fnargs</span><span class="p">,</span> <span class="o">**</span><span class="n">fnkwds</span><span class="p">)</span>
                    
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;getObjValue&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">]</span>  <span class="c1">## has already been unpickled into its local value</span>
                <span class="n">returnType</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;transfer&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">]</span>
                <span class="n">returnType</span> <span class="o">=</span> <span class="s1">&#39;proxy&#39;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;transferArray&#39;</span><span class="p">:</span>
                <span class="c1">## read array data from next message:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">byteData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
                <span class="n">returnType</span> <span class="o">=</span> <span class="s1">&#39;proxy&#39;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;import&#39;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
                <span class="n">fromlist</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fromlist&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="n">fromlist</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fromlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">mod</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">,</span> <span class="n">fromlist</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;del&#39;</span><span class="p">:</span>
                <span class="n">LocalObjectProxy</span><span class="o">.</span><span class="n">releaseProxyId</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;proxyId&#39;</span><span class="p">])</span>
                <span class="c1">#del self.proxiedObjects[opts[&#39;objId&#39;]]</span>
                
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">reqId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">returnType</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
                    
            <span class="n">exc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

            
            
        <span class="k">if</span> <span class="n">reqId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: sending return value for </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> 
                <span class="c1">#print &quot;returnValue:&quot;, returnValue, result</span>
                <span class="k">if</span> <span class="n">returnType</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">optsLock</span><span class="p">:</span>
                        <span class="n">noProxyTypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="s1">&#39;noProxyTypes&#39;</span><span class="p">]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoProxy</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">noProxyTypes</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">returnType</span> <span class="o">==</span> <span class="s1">&#39;proxy&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">LocalObjectProxy</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">replyResult</span><span class="p">(</span><span class="n">reqId</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">replyError</span><span class="p">(</span><span class="n">reqId</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s2">&quot;    handleRequest: returning exception for </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reqId</span><span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">replyError</span><span class="p">(</span><span class="n">reqId</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">)</span>
                    
        <span class="k">elif</span> <span class="n">exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="o">*</span><span class="n">exc</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;noCleanup&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">## exit immediately, do not pass GO, do not collect $200.</span>
                             <span class="c1">## (more importantly, do not call any code that would</span>
                             <span class="c1">## normally be invoked at exit)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span></div>
        
    
    
<div class="viewcode-block" id="RemoteEventHandler.replyResult"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.replyResult">[docs]</a>    <span class="k">def</span> <span class="nf">replyResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">reqId</span><span class="o">=</span><span class="n">reqId</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.replyError"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.replyError">[docs]</a>    <span class="k">def</span> <span class="nf">replyError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">reqId</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">excStr</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="o">*</span><span class="n">exc</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">reqId</span><span class="o">=</span><span class="n">reqId</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">exc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">excString</span><span class="o">=</span><span class="n">excStr</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">reqId</span><span class="o">=</span><span class="n">reqId</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excString</span><span class="o">=</span><span class="n">excStr</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.send"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reqId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">returnType</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteData</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a request or return packet to the remote process.</span>
<span class="sd">        Generally it is not necessary to call this method directly; it is for internal use.</span>
<span class="sd">        (The docstring has information that is nevertheless useful to the programmer</span>
<span class="sd">        as it describes the internal protocol used to communicate between processes)</span>
<span class="sd">        </span>
<span class="sd">        ==============  ====================================================================</span>
<span class="sd">        **Arguments:**</span>
<span class="sd">        request         String describing the type of request being sent (see below)</span>
<span class="sd">        reqId           Integer uniquely linking a result back to the request that generated</span>
<span class="sd">                        it. (most requests leave this blank)</span>
<span class="sd">        callSync        &#39;sync&#39;:  return the actual result of the request</span>
<span class="sd">                        &#39;async&#39;: return a Request object which can be used to look up the</span>
<span class="sd">                                result later</span>
<span class="sd">                        &#39;off&#39;:   return no result</span>
<span class="sd">        timeout         Time in seconds to wait for a response when callSync==&#39;sync&#39;</span>
<span class="sd">        opts            Extra arguments sent to the remote process that determine the way</span>
<span class="sd">                        the request will be handled (see below)</span>
<span class="sd">        returnType      &#39;proxy&#39;, &#39;value&#39;, or &#39;auto&#39;</span>
<span class="sd">        byteData        If specified, this is a list of objects to be sent as byte messages</span>
<span class="sd">                        to the remote process.</span>
<span class="sd">                        This is used to send large arrays without the cost of pickling.</span>
<span class="sd">        ==============  ====================================================================</span>
<span class="sd">        </span>
<span class="sd">        Description of request strings and options allowed for each:</span>
<span class="sd">        </span>
<span class="sd">        =============  =============  ========================================================</span>
<span class="sd">        request        option         description</span>
<span class="sd">        -------------  -------------  --------------------------------------------------------</span>
<span class="sd">        getObjAttr                    Request the remote process return (proxy to) an</span>
<span class="sd">                                      attribute of an object.</span>
<span class="sd">                       obj            reference to object whose attribute should be </span>
<span class="sd">                                      returned</span>
<span class="sd">                       attr           string name of attribute to return</span>
<span class="sd">                       returnValue    bool or &#39;auto&#39; indicating whether to return a proxy or</span>
<span class="sd">                                      the actual value. </span>
<span class="sd">                       </span>
<span class="sd">        callObj                       Request the remote process call a function or </span>
<span class="sd">                                      method. If a request ID is given, then the call&#39;s</span>
<span class="sd">                                      return value will be sent back (or information</span>
<span class="sd">                                      about the error that occurred while running the</span>
<span class="sd">                                      function)</span>
<span class="sd">                       obj            the (reference to) object to call</span>
<span class="sd">                       args           tuple of arguments to pass to callable</span>
<span class="sd">                       kwds           dict of keyword arguments to pass to callable</span>
<span class="sd">                       returnValue    bool or &#39;auto&#39; indicating whether to return a proxy or</span>
<span class="sd">                                      the actual value. </span>
<span class="sd">                       </span>
<span class="sd">        getObjValue                   Request the remote process return the value of</span>
<span class="sd">                                      a proxied object (must be picklable)</span>
<span class="sd">                       obj            reference to object whose value should be returned</span>
<span class="sd">                       </span>
<span class="sd">        transfer                      Copy an object to the remote process and request</span>
<span class="sd">                                      it return a proxy for the new object.</span>
<span class="sd">                       obj            The object to transfer.</span>
<span class="sd">                       </span>
<span class="sd">        import                        Request the remote process import new symbols</span>
<span class="sd">                                      and return proxy(ies) to the imported objects</span>
<span class="sd">                       module         the string name of the module to import</span>
<span class="sd">                       fromlist       optional list of string names to import from module</span>
<span class="sd">                       </span>
<span class="sd">        del                           Inform the remote process that a proxy has been </span>
<span class="sd">                                      released (thus the remote process may be able to </span>
<span class="sd">                                      release the original object)</span>
<span class="sd">                       proxyId        id of proxy which is no longer referenced by </span>
<span class="sd">                                      remote host</span>
<span class="sd">                                      </span>
<span class="sd">        close                         Instruct the remote process to stop its event loop</span>
<span class="sd">                                      and exit. Optionally, this request may return a </span>
<span class="sd">                                      confirmation.</span>
<span class="sd">            </span>
<span class="sd">        result                        Inform the remote process that its request has </span>
<span class="sd">                                      been processed                        </span>
<span class="sd">                       result         return value of a request</span>
<span class="sd">                       </span>
<span class="sd">        error                         Inform the remote process that its request failed</span>
<span class="sd">                       exception      the Exception that was raised (or None if the </span>
<span class="sd">                                      exception could not be pickled)</span>
<span class="sd">                       excString      string-formatted version of the exception and </span>
<span class="sd">                                      traceback</span>
<span class="sd">        =============  =====================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exited</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  send: exited already; raise ClosedError.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
        
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendLock</span><span class="p">:</span>
            <span class="c1">#if len(kwds) &gt; 0:</span>
                <span class="c1">#print &quot;Warning: send() ignored args:&quot;, kwds</span>
                
            <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">assert</span> <span class="n">callSync</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;async&#39;</span><span class="p">],</span> <span class="s1">&#39;callSync must be one of &quot;off&quot;, &quot;sync&quot;, or &quot;async&quot;&#39;</span>
            <span class="k">if</span> <span class="n">reqId</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callSync</span> <span class="o">!=</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span> <span class="c1">## requested return value; use the next available request ID</span>
                    <span class="n">reqId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextRequestId</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nextRequestId</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">## If requestId is provided, this _must_ be a response to a previously received request.</span>
                <span class="k">assert</span> <span class="n">request</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">returnType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;returnType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">returnType</span>
                
            <span class="c1">#print os.getpid(), &quot;send request:&quot;, request, reqId, opts</span>
            
            <span class="c1">## double-pickle args to ensure that at least status and request ID get through</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">optStr</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;====  Error pickling this object:  ====&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=======================================&quot;</span><span class="p">)</span>
                <span class="k">raise</span>
            
            <span class="n">nByteMsgs</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">byteData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nByteMsgs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteData</span><span class="p">)</span>
                
            <span class="c1">## Send primary request</span>
            <span class="n">request</span> <span class="o">=</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">nByteMsgs</span><span class="p">,</span> <span class="n">optStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;send request: cmd=</span><span class="si">%s</span><span class="s1"> nByteMsgs=</span><span class="si">%d</span><span class="s1"> id=</span><span class="si">%s</span><span class="s1"> opts=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nByteMsgs</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            
            <span class="c1">## follow up by sending byte messages</span>
            <span class="k">if</span> <span class="n">byteData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">byteData</span><span class="p">:</span>  <span class="c1">## Remote process _must_ be prepared to read the same number of byte messages!</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_bytes</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  sent </span><span class="si">%d</span><span class="s1"> byte messages&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteData</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">debugMsg</span><span class="p">(</span><span class="s1">&#39;  call sync: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">callSync</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">callSync</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
                <span class="k">return</span>
            
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">callSync</span> <span class="o">==</span> <span class="s1">&#39;async&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">req</span>
            
        <span class="k">if</span> <span class="n">callSync</span> <span class="o">==</span> <span class="s1">&#39;sync&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NoResultError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">req</span></div>
        
<div class="viewcode-block" id="RemoteEventHandler.close"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">noCleanup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">noCleanup</span><span class="o">=</span><span class="n">noCleanup</span><span class="p">),</span> <span class="n">callSync</span><span class="o">=</span><span class="n">callSync</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exited</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">ClosedError</span><span class="p">:</span>
            <span class="k">pass</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.getResult"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.getResult">[docs]</a>    <span class="k">def</span> <span class="nf">getResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reqId</span><span class="p">):</span>
        <span class="c1">## raises NoResultError if the result is not available yet</span>
        <span class="c1">#print self.results.keys(), os.getpid()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultLock</span><span class="p">:</span>
            <span class="n">haveResult</span> <span class="o">=</span> <span class="n">reqId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">haveResult</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processRequests</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ClosedError</span><span class="p">:</span>  <span class="c1">## even if remote connection has closed, we may have </span>
                                 <span class="c1">## received new data during this call to processRequests()</span>
                <span class="k">pass</span>
        
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultLock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reqId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoResultError</span><span class="p">()</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">reqId</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
            <span class="c1">#print &#39;&#39;.join(result)</span>
            <span class="n">exc</span><span class="p">,</span> <span class="n">excStr</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===== Remote process raised exception on request: =====&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">excStr</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===== Local Traceback to request follows: =====&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">excStr</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error getting result. See above for exception from remote process.&quot;</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Internal error.&quot;</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request the remote process import a module (or symbols from a module)</span>
<span class="sd">        and return the proxied results. Uses built-in __import__() function, but </span>
<span class="sd">        adds a bit more processing:</span>
<span class="sd">        </span>
<span class="sd">            _import(&#39;module&#39;)  =&gt;  returns module</span>
<span class="sd">            _import(&#39;module.submodule&#39;)  =&gt;  returns submodule </span>
<span class="sd">                                             (note this differs from behavior of __import__)</span>
<span class="sd">            _import(&#39;module&#39;, fromlist=[name1, name2, ...])  =&gt;  returns [module.name1, module.name2, ...]</span>
<span class="sd">                                             (this also differs from behavior of __import__)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">mod</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        
<div class="viewcode-block" id="RemoteEventHandler.getObjAttr"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.getObjAttr">[docs]</a>    <span class="k">def</span> <span class="nf">getObjAttr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;getObjAttr&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">attr</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="RemoteEventHandler.getObjValue"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.getObjValue">[docs]</a>    <span class="k">def</span> <span class="nf">getObjValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;getObjValue&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="RemoteEventHandler.callObj"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.callObj">[docs]</a>    <span class="k">def</span> <span class="nf">callObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        
        <span class="c1">## Decide whether to send arguments by value or by proxy</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">optsLock</span><span class="p">:</span>
            <span class="n">noProxyTypes</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;noProxyTypes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">noProxyTypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">noProxyTypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="s1">&#39;noProxyTypes&#39;</span><span class="p">]</span>
                
            <span class="n">autoProxy</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;autoProxy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyOptions</span><span class="p">[</span><span class="s1">&#39;autoProxy&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">autoProxy</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">autoProxy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">noProxyTypes</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoProxy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">noProxyTypes</span><span class="p">)</span>
        
        <span class="n">byteMsgs</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1">## If there are arrays in the arguments, send those as byte messages.</span>
        <span class="c1">## We do this because pickling arrays is too expensive.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;__byte_message__&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteMsgs</span><span class="p">),</span> <span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">byteMsgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">kwds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;__byte_message__&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteMsgs</span><span class="p">),</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">byteMsgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;callObj&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="o">=</span><span class="n">kwds</span><span class="p">),</span> <span class="n">byteData</span><span class="o">=</span><span class="n">byteMsgs</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="RemoteEventHandler.registerProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.registerProxy">[docs]</a>    <span class="k">def</span> <span class="nf">registerProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyLock</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteProxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">_proxyId</span></div>
    
<div class="viewcode-block" id="RemoteEventHandler.deleteProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.deleteProxy">[docs]</a>    <span class="k">def</span> <span class="nf">deleteProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxyLock</span><span class="p">:</span>
            <span class="n">proxyId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;del&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">proxyId</span><span class="o">=</span><span class="n">proxyId</span><span class="p">),</span> <span class="n">callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ClosedError</span><span class="p">:</span>  <span class="c1">## if remote process has closed down, there is no need to send delete requests anymore</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="RemoteEventHandler.transfer"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.transfer">[docs]</a>    <span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transfer an object by value to the remote host (the object must be picklable) </span>
<span class="sd">        and return a proxy for the new remote object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;transferArray&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">,</span> <span class="n">byteData</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="RemoteEventHandler.autoProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.RemoteEventHandler.autoProxy">[docs]</a>    <span class="k">def</span> <span class="nf">autoProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">noProxyTypes</span><span class="p">):</span>
        <span class="c1">## Return object wrapped in LocalObjectProxy _unless_ its type is in noProxyTypes.</span>
        <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">noProxyTypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="n">LocalObjectProxy</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div></div>
        
        
<div class="viewcode-block" id="Request"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.Request">[docs]</a><span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request objects are returned when calling an ObjectProxy in asynchronous mode</span>
<span class="sd">    or if a synchronous call has timed out. Use hasResult() to ask whether</span>
<span class="sd">    the result of the call has been returned yet. Use result() to get</span>
<span class="sd">    the returned value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">reqId</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc</span> <span class="o">=</span> <span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reqId</span> <span class="o">=</span> <span class="n">reqId</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gotResult</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        
<div class="viewcode-block" id="Request.result"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.Request.result">[docs]</a>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the result for this request. </span>
<span class="sd">        </span>
<span class="sd">        If block is True, wait until the result has arrived or *timeout* seconds passes.</span>
<span class="sd">        If the timeout is reached, raise NoResultError. (use timeout=None to disable)</span>
<span class="sd">        If block is False, raise NoResultError immediately if the result has not arrived yet.</span>
<span class="sd">        </span>
<span class="sd">        If the process&#39;s connection has closed before the result arrives, raise ClosedError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gotResult</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result</span>
            
        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> 
        
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasResult</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">exited</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ClosedError</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timeout</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request timed out: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                    <span class="kn">import</span> <span class="nn">traceback</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="n">NoResultError</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">getResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reqId</span><span class="p">)</span>  <span class="c1">## raises NoResultError if result is not available yet</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gotResult</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result</span></div>
        
<div class="viewcode-block" id="Request.hasResult"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.Request.hasResult">[docs]</a>    <span class="k">def</span> <span class="nf">hasResult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the result for this request has arrived.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoResultError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gotResult</span></div></div>

<div class="viewcode-block" id="LocalObjectProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.LocalObjectProxy">[docs]</a><span class="k">class</span> <span class="nc">LocalObjectProxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used for wrapping local objects to ensure that they are send by proxy to a remote host.</span>
<span class="sd">    Note that &#39;proxy&#39; is just a shorter alias for LocalObjectProxy.</span>
<span class="sd">    </span>
<span class="sd">    For example::</span>
<span class="sd">    </span>
<span class="sd">        data = [1,2,3,4,5]</span>
<span class="sd">        remotePlot.plot(data)         ## by default, lists are pickled and sent by value</span>
<span class="sd">        remotePlot.plot(proxy(data))  ## force the object to be sent by proxy</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nextProxyId</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">proxiedObjects</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">## maps {proxyId: object}</span>
    
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="LocalObjectProxy.registerObject"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.LocalObjectProxy.registerObject">[docs]</a>    <span class="k">def</span> <span class="nf">registerObject</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1">## assign it a unique ID so we can keep a reference to the local object</span>
        
        <span class="n">pid</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">nextProxyId</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">nextProxyId</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">proxiedObjects</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="c1">#print &quot;register:&quot;, cls.proxiedObjects</span>
        <span class="k">return</span> <span class="n">pid</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="LocalObjectProxy.lookupProxyId"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.LocalObjectProxy.lookupProxyId">[docs]</a>    <span class="k">def</span> <span class="nf">lookupProxyId</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">proxiedObjects</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span></div>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="LocalObjectProxy.releaseProxyId"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.LocalObjectProxy.releaseProxyId">[docs]</a>    <span class="k">def</span> <span class="nf">releaseProxyId</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">cls</span><span class="o">.</span><span class="n">proxiedObjects</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span></div>
        <span class="c1">#print &quot;release:&quot;, cls.proxiedObjects </span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a &#39;local&#39; proxy object that, when sent to a remote host,</span>
<span class="sd">        will appear as a normal ObjectProxy to *obj*. </span>
<span class="sd">        Any extra keyword arguments are passed to proxy._setProxyOptions()</span>
<span class="sd">        on the remote side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processId</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="c1">#self.objectId = id(obj)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeStr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1">#self.handler = handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span>
        
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## a proxy is being pickled and sent to a remote process.</span>
        <span class="c1">## every time this happens, a new proxy will be generated in the remote process,</span>
        <span class="c1">## so we keep a new ID so we can track when each is released.</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">LocalObjectProxy</span><span class="o">.</span><span class="n">registerObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">unpickleObjectProxy</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processId</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typeStr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opts</span><span class="p">))</span></div>
        
<span class="c1">## alias</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="n">LocalObjectProxy</span>

<div class="viewcode-block" id="unpickleObjectProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.unpickleObjectProxy">[docs]</a><span class="k">def</span> <span class="nf">unpickleObjectProxy</span><span class="p">(</span><span class="n">processId</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">,</span> <span class="n">typeStr</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">processId</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">():</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">LocalObjectProxy</span><span class="o">.</span><span class="n">lookupProxyId</span><span class="p">(</span><span class="n">proxyId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">ObjectProxy</span><span class="p">(</span><span class="n">processId</span><span class="p">,</span> <span class="n">proxyId</span><span class="o">=</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">typeStr</span><span class="o">=</span><span class="n">typeStr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">_setProxyOptions</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proxy</span></div>
    
<div class="viewcode-block" id="ObjectProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.ObjectProxy">[docs]</a><span class="k">class</span> <span class="nc">ObjectProxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Proxy to an object stored by the remote process. Proxies are created</span>
<span class="sd">    by calling Process._import(), Process.transfer(), or by requesting/calling</span>
<span class="sd">    attributes on existing proxy objects.</span>
<span class="sd">    </span>
<span class="sd">    For the most part, this object can be used exactly as if it</span>
<span class="sd">    were a local object::</span>
<span class="sd">    </span>
<span class="sd">        rsys = proc._import(&#39;sys&#39;)   # returns proxy to sys module on remote process</span>
<span class="sd">        rsys.stdout                  # proxy to remote sys.stdout</span>
<span class="sd">        rsys.stdout.write            # proxy to remote sys.stdout.write</span>
<span class="sd">        rsys.stdout.write(&#39;hello&#39;)   # calls sys.stdout.write(&#39;hello&#39;) on remote machine</span>
<span class="sd">                                     # and returns the result (None)</span>
<span class="sd">    </span>
<span class="sd">    When calling a proxy to a remote function, the call can be made synchronous</span>
<span class="sd">    (result of call is returned immediately), asynchronous (result is returned later),</span>
<span class="sd">    or return can be disabled entirely::</span>
<span class="sd">    </span>
<span class="sd">        ros = proc._import(&#39;os&#39;)</span>
<span class="sd">        </span>
<span class="sd">        ## synchronous call; result is returned immediately</span>
<span class="sd">        pid = ros.getpid()</span>
<span class="sd">        </span>
<span class="sd">        ## asynchronous call</span>
<span class="sd">        request = ros.getpid(_callSync=&#39;async&#39;)</span>
<span class="sd">        while not request.hasResult():</span>
<span class="sd">            time.sleep(0.01)</span>
<span class="sd">        pid = request.result()</span>
<span class="sd">        </span>
<span class="sd">        ## disable return when we know it isn&#39;t needed</span>
<span class="sd">        rsys.stdout.write(&#39;hello&#39;, _callSync=&#39;off&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Additionally, values returned from a remote function call are automatically</span>
<span class="sd">    returned either by value (must be picklable) or by proxy. </span>
<span class="sd">    This behavior can be forced::</span>
<span class="sd">    </span>
<span class="sd">        rnp = proc._import(&#39;numpy&#39;)</span>
<span class="sd">        arrProxy = rnp.array([1,2,3,4], _returnType=&#39;proxy&#39;)</span>
<span class="sd">        arrValue = rnp.array([1,2,3,4], _returnType=&#39;value&#39;)</span>
<span class="sd">    </span>
<span class="sd">    The default callSync and returnType behaviors (as well as others) can be set </span>
<span class="sd">    for each proxy individually using ObjectProxy._setProxyOptions() or globally using </span>
<span class="sd">    proc.setProxyOptions(). </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processId</span><span class="p">,</span> <span class="n">proxyId</span><span class="p">,</span> <span class="n">typeStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">## can&#39;t set attributes directly because setattr is overridden.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_processId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processId</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_typeStr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typeStr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_proxyId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxyId</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
        <span class="c1">## attributes that affect the behavior of the proxy. </span>
        <span class="c1">## in all cases, a value of None causes the proxy to ask</span>
        <span class="c1">## its parent event handler to make the decision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_proxyOptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;callSync&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>      <span class="c1">## &#39;sync&#39;, &#39;async&#39;, None </span>
            <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>       <span class="c1">## float, None</span>
            <span class="s1">&#39;returnType&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>    <span class="c1">## &#39;proxy&#39;, &#39;value&#39;, &#39;auto&#39;, None</span>
            <span class="s1">&#39;deferGetattr&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1">## True, False, None</span>
            <span class="s1">&#39;noProxyTypes&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1">## list of types to send by value instead of by proxy</span>
            <span class="s1">&#39;autoProxy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_handler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RemoteEventHandler</span><span class="o">.</span><span class="n">getHandler</span><span class="p">(</span><span class="n">processId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_handler&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">registerProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1">## handler will watch proxy; inform remote process when the proxy is deleted.</span>
    
    <span class="k">def</span> <span class="nf">_setProxyOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the behavior of this proxy. For all options, a value of None</span>
<span class="sd">        will cause the proxy to instead use the default behavior defined</span>
<span class="sd">        by its parent Process.</span>
<span class="sd">        </span>
<span class="sd">        Options are:</span>
<span class="sd">        </span>
<span class="sd">        =============  =============================================================</span>
<span class="sd">        callSync       &#39;sync&#39;, &#39;async&#39;, &#39;off&#39;, or None. </span>
<span class="sd">                       If &#39;async&#39;, then calling methods will return a Request object</span>
<span class="sd">                       which can be used to inquire later about the result of the </span>
<span class="sd">                       method call.</span>
<span class="sd">                       If &#39;sync&#39;, then calling a method</span>
<span class="sd">                       will block until the remote process has returned its result</span>
<span class="sd">                       or the timeout has elapsed (in this case, a Request object</span>
<span class="sd">                       is returned instead).</span>
<span class="sd">                       If &#39;off&#39;, then the remote process is instructed _not_ to </span>
<span class="sd">                       reply and the method call will return None immediately.</span>
<span class="sd">        returnType     &#39;auto&#39;, &#39;proxy&#39;, &#39;value&#39;, or None. </span>
<span class="sd">                       If &#39;proxy&#39;, then the value returned when calling a method</span>
<span class="sd">                       will be a proxy to the object on the remote process.</span>
<span class="sd">                       If &#39;value&#39;, then attempt to pickle the returned object and</span>
<span class="sd">                       send it back.</span>
<span class="sd">                       If &#39;auto&#39;, then the decision is made by consulting the</span>
<span class="sd">                       &#39;noProxyTypes&#39; option.</span>
<span class="sd">        autoProxy      bool or None. If True, arguments to __call__ are </span>
<span class="sd">                       automatically converted to proxy unless their type is </span>
<span class="sd">                       listed in noProxyTypes (see below). If False, arguments</span>
<span class="sd">                       are left untouched. Use proxy(obj) to manually convert</span>
<span class="sd">                       arguments before sending. </span>
<span class="sd">        timeout        float or None. Length of time to wait during synchronous </span>
<span class="sd">                       requests before returning a Request object instead.</span>
<span class="sd">        deferGetattr   True, False, or None. </span>
<span class="sd">                       If False, all attribute requests will be sent to the remote </span>
<span class="sd">                       process immediately and will block until a response is</span>
<span class="sd">                       received (or timeout has elapsed).</span>
<span class="sd">                       If True, requesting an attribute from the proxy returns a</span>
<span class="sd">                       new proxy immediately. The remote process is _not_ contacted</span>
<span class="sd">                       to make this request. This is faster, but it is possible to </span>
<span class="sd">                       request an attribute that does not exist on the proxied</span>
<span class="sd">                       object. In this case, AttributeError will not be raised</span>
<span class="sd">                       until an attempt is made to look up the attribute on the</span>
<span class="sd">                       remote process.</span>
<span class="sd">        noProxyTypes   List of object types that should _not_ be proxied when</span>
<span class="sd">                       sent to the remote process.</span>
<span class="sd">        =============  =============================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxyOptions</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unrecognized proxy option &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proxyOptions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of the proxied object</span>
<span class="sd">        (the remote object must be picklable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">getObjValue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_getProxyOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxyOptions</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">getProxyOption</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
    
    <span class="k">def</span> <span class="nf">_getProxyOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getProxyOption</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxyOptions</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">unpickleObjectProxy</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processId</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxyId</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#objRepr = self.__getattr__(&#39;__repr__&#39;)(callSync=&#39;value&#39;)</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;ObjectProxy for process </span><span class="si">%d</span><span class="s2">, object 0x</span><span class="si">%x</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> &gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processId</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxyId</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeStr</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls __getattr__ on the remote object and returns the attribute</span>
<span class="sd">        by value or by proxy depending on the options set (see</span>
<span class="sd">        ObjectProxy._setProxyOptions and RemoteEventHandler.setProxyOptions)</span>
<span class="sd">        </span>
<span class="sd">        If the option &#39;deferGetattr&#39; is True for this proxy, then a new proxy object</span>
<span class="sd">        is returned _without_ asking the remote object whether the named attribute exists.</span>
<span class="sd">        This can save time when making multiple chained attribute requests,</span>
<span class="sd">        but may also defer a possible AttributeError until later, making</span>
<span class="sd">        them more difficult to debug.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getProxyOptions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;deferGetattr&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferredAttr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#opts = self._getProxyOptions()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">getObjAttr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_deferredAttr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DeferredObjectProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to call the proxied object from the remote process.</span>
<span class="sd">        Accepts extra keyword arguments:</span>
<span class="sd">        </span>
<span class="sd">            _callSync    &#39;off&#39;, &#39;sync&#39;, or &#39;async&#39;</span>
<span class="sd">            _returnType   &#39;value&#39;, &#39;proxy&#39;, or &#39;auto&#39;</span>
<span class="sd">        </span>
<span class="sd">        If the remote call raises an exception on the remote process,</span>
<span class="sd">        it will be re-raised on the local process.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getProxyOptions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">callObj</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="o">=</span><span class="n">kwds</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
    
    
    <span class="c1">## Explicitly proxy special methods. Is there a better way to do this??</span>
    
    <span class="k">def</span> <span class="nf">_getSpecialAttr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="c1">## this just gives us an easy way to change the behavior of the special methods</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deferredAttr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__getitem__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__setitem__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__setattr__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__str__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_returnType</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__len__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__add__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__sub__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__div__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__truediv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__floordiv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__mul__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__pow__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__iadd__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__isub__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__idiv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__itruediv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ifloordiv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__imul__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ipow__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__lshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__irshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__irshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ilshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ilshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__eq__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ne__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__lt__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__gt__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__le__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ge__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__and__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__or__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__xor__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__iand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__iand__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ior__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ixor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ixor__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_callSync</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__mod__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__radd__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rsub__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rdiv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rfloordiv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rtruediv__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rmul__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rpow__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rrshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rlshift__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rand__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ror__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__ror__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSpecialAttr</span><span class="p">(</span><span class="s1">&#39;__rmod__&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## Required for python3 since __eq__ is defined.</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="DeferredObjectProxy"><a class="viewcode-back" href="../../../../../iris.gui.pyqtgraph.multiprocess.html#iris.gui.pyqtgraph.multiprocess.processes.DeferredObjectProxy">[docs]</a><span class="k">class</span> <span class="nc">DeferredObjectProxy</span><span class="p">(</span><span class="n">ObjectProxy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents an attribute (or sub-attribute) of a proxied object.</span>
<span class="sd">    It is used to speed up attribute requests. Take the following scenario::</span>
<span class="sd">    </span>
<span class="sd">        rsys = proc._import(&#39;sys&#39;)</span>
<span class="sd">        rsys.stdout.write(&#39;hello&#39;)</span>
<span class="sd">        </span>
<span class="sd">    For this simple example, a total of 4 synchronous requests are made to </span>
<span class="sd">    the remote process: </span>
<span class="sd">    </span>
<span class="sd">    1) import sys</span>
<span class="sd">    2) getattr(sys, &#39;stdout&#39;)</span>
<span class="sd">    3) getattr(stdout, &#39;write&#39;)</span>
<span class="sd">    4) write(&#39;hello&#39;)</span>
<span class="sd">    </span>
<span class="sd">    This takes a lot longer than running the equivalent code locally. To</span>
<span class="sd">    speed things up, we can &#39;defer&#39; the two attribute lookups so they are</span>
<span class="sd">    only carried out when neccessary::</span>
<span class="sd">    </span>
<span class="sd">        rsys = proc._import(&#39;sys&#39;)</span>
<span class="sd">        rsys._setProxyOptions(deferGetattr=True)</span>
<span class="sd">        rsys.stdout.write(&#39;hello&#39;)</span>
<span class="sd">        </span>
<span class="sd">    This example only makes two requests to the remote process; the two </span>
<span class="sd">    attribute lookups immediately return DeferredObjectProxy instances </span>
<span class="sd">    immediately without contacting the remote process. When the call </span>
<span class="sd">    to write() is made, all attribute requests are processed at the same time.</span>
<span class="sd">    </span>
<span class="sd">    Note that if the attributes requested do not exist on the remote object, </span>
<span class="sd">    making the call to write() will raise an AttributeError.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentProxy</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="c1">## can&#39;t set attributes directly because setattr is overridden.</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_processId&#39;</span><span class="p">,</span> <span class="s1">&#39;_typeStr&#39;</span><span class="p">,</span> <span class="s1">&#39;_proxyId&#39;</span><span class="p">,</span> <span class="s1">&#39;_handler&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parentProxy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parentProxy</span>  <span class="c1">## make sure parent stays alive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parentProxy</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">+</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;_proxyOptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parentProxy</span><span class="o">.</span><span class="n">_proxyOptions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ObjectProxy</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_undefer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a non-deferred ObjectProxy referencing the same object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_deferGetattr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../index.html">Module code</a><ul>
  <li><a href="../../pyqtgraph.html">iris.gui.pyqtgraph</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>